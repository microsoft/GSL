trigger:
  - main

pr:
  autoCancel: true

stages:
- stage: GCC
  dependsOn: []
  jobs:
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: gcc
      image: ubuntu-20.04
      compilerVersions: [ 11, 10 ]
      setupfile: 'setup_gcc.yml'

- stage: Clang
  dependsOn: []
  jobs:
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: clang
      image: ubuntu-20.04
      compilerVersions: [ 11, 10 ]
      setupfile: 'setup_clang.yml'

- stage: Xcode
  dependsOn: []
  jobs:
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: 'Xcode'
      image: macOS-11
      compilerVersions: [ '12.5.1', '13.1' ]
      setupfile: 'setup_apple.yml'

- stage: VS_MSVC
  dependsOn: []
  jobs:
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: 'VS2019 (16.11)'
      compilerVersions: [ 'MSVC' ]
      image: windows-2019
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: 'VS2022 (17.0)'
      compilerVersions: [ 'MSVC' ]
      image: windows-2022

- stage: VS_LLVM
  dependsOn: []
  jobs:
  - template: ./pipelines/jobs.yml
    parameters:
      compiler: 'VS2019 (16.11)'
      compilerVersions: [ 'LLVM' ]
      image: windows-2019
      extraCmakeArgs: '-T ClangCL'

# The *same* config as with 2019 but on 2022 yields an error.
# Tracking issue: https://github.com/actions/virtual-environments/issues/4716
# - template: ./pipelines/jobs.yml
#   parameters:
#     compiler: 'VS2022 LLVM'
#     compilerVersions: [ '17.0' ]
#     image: windows-2022
#     extraCmakeArgs: '-T ClangCL'
#     CXXVersions: [ 14 ]
#     buildTypes: [ Release ]
